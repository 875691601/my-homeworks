% function [pcs,cprs_data,cprs_c] = pca_compress(data,rerr)
function cprs_data = pca_compress(data,rerr)
%-----------------????????????-------------------%
% data??????????????????????????????????????rerr????????????
% pcs????????????????????????????????????cprs_data????????????????
% cprs_c????????????????????????????????????????????????
%-------------------------------------------------%
%% ??????????????
[N,n] = size(data);
% ????
data_ave = mean(data);   
% ??????
data_delta = std(data); 
% data_norm??????????????????
for i = 1:n
    data_norm(:,i) = (data(:,i) - data_ave(i))/data_delta(i);
end
data_norm = data_norm';
%% ??????????????????
A = data_norm * data_norm';
[Q,D] = eig(A);
d = diag(D);  %????n????????
%??????????????????????????????????
[d_order,order] = sort(d,'descend'); 
% ??????????????
d_order = d_order/(N-1);
for i = 1:n
    Q_order(:,i) = Q(:,order(i));
end
plot(d_order,'-s');

% m??n-1????????????????????????????????????m
for m = n-1:-1:1
    err = sum(d_order(m+1:n))/n;
    if(err >= 1 - rerr)
        m = m+1;
        break;
    end
end
% Q_order????m????????????????
pcs = Q_order(:,1:m);
%% ??????????
% ????????????????????????????
cprs_data = pcs' * data_norm;
% ??1??????????????2??????????
% cprs_c(1,1:n) = data_ave;
% cprs_c(2,1:n) = data_delta;